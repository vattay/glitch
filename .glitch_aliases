IMAGE='oxide/glitch'

alias d0-clean='docker system prune'
alias d0-stop-all='docker stop $(docker ps -q)'
alias d0-purge='docker system prune -a '
alias d0-run-it='docker run -it --rm '
alias d0-bt='docker build -t'
alias d0-run-it-dsock='docker run -it --rm -v /var/run/docker.sock:/var/run/docker.sock'

DOCKER_GID=''
docker-sock-gid () {
    UN=$(uname)
    if [ "$UN" = "Darwin" ]; then
        DOCKER_GID=$(docker run --rm -it --privileged --pid=host debian nsenter -t 1 -m -u -n -i ls -anl /var/run/docker.sock | cut -d ' ' -f 14) 
    else
        DOCKER_GID=$(ls -nl /var/run/docker.sock | cut -d ' ' -f4)
    fi
}

d0-rs () {
    docker-sock-gid
    docker run -it --rm \
      -v /var/run/docker.sock:/var/run/docker.sock \
      -v "$(pwd)":/root/workspace/bound \
      -v glitch-volume:/var/shared \
      --group-add $DOCKER_GID \
      $@
}

glitch () {
    d0-rs $@ $IMAGE
}

glitch-new () {
    NAME=$1
    shift 1
    d0-rs --name="$NAME" $@ $IMAGE 
}

glitch-build () {
    docker build -t $IMAGE .
}

glitch-build-nocache () {

    docker build --no-cache -t $IMAGE .
}
